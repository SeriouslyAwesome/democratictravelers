DemocraticTravelers.API =
  Host: 'http://api.thedemocratictravelers.com'
  Prefix: '/v1/'
  Base: "<%= Rails.env.production? ? 'http://api.thedemocratictravelers.com/v1' : 'http://api.democratictravelers.dev/v1' %>"
  getJSON: (endpoint, callback) ->
    url = "#{@Base}/#{endpoint}"
    apiKey = $("meta[name='application-name']").attr('data-api-key')
    userId = $("meta[name='application-name']").attr('data-user-id')
    $.ajax url,
      dataType: 'json'
      beforeSend: (xhr) ->
        xhr.setRequestHeader('X-API-KEY', apiKey)
        xhr.setRequestHeader('X-USER-ID', userId)

        DemocraticTravelers.Map.locationsLayer.clearLayers()
        $('.suggestion').not('#new-suggestion').remove()
        $('#map-loading:hidden').fadeIn('fast')
      success: (data, callback) ->
        DemocraticTravelers.Map.renderMarkers data.locations
        DemocraticTravelers.Experience.renderAll data.experiences
      error: (e) ->
        console.log(e)
        return true
      complete: ->
        $('#map-loading:visible').fadeOut('fast')
      statusCode:
        401: ->
          console.log('Login is required.')
        403: ->
          console.log('Not authorized.')
        404: ->
          console.log('Dead link.')
          
  